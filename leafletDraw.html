<!DOCTYPE html>
<html>
<head>
    <title>Draw for TiddlyWiki Leaflet plugin</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <link rel="stylesheet" href="http://leaflet.github.io/Leaflet.draw/leaflet.draw.css" />
    <style type="text/css">
    h1 {font-size:14px;font-family:sans-serif;margin:0}
    p {box-sizing:border-box;display:inline-block;width:49%;vertical-align:top}    
    </style>
</head>

<body>
    <h1>Draw for TiddlyWiki Leaflet plugin</h1>
    <p>this page uses <a href="http://leafletjs.com" target="_blank">leaflet</a> <a href="" target="_blank">draw plugin</a> to design shapes for your <a href="./#Leaflet%20Plugin" target="_blank">tiddlywiki leaflet maps</a>.</p>
    <p><textarea id="coord" style="width:100%;font-family:monospace;font-size:10px;height:4em"></textarea>
    </p>
    <div id="map" style="width: 100%; height: 700px"></div>
    <br/>
    
    

    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script src="http://leaflet.github.io/Leaflet.draw/leaflet.draw.js"></script>

    <script>
        // tile backgrounds        var fonds = [    {        "id": "osm",        "nom": "OpenStreetMap",
        "url": "http://{s}.tile.osm.org/{z}/{x}/{y}.png",
        "attrib": "tiles by &copy;<a href='http://osm.org/copyright' target='_blank'>OSM</a>, licence <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>.",
        "zMin": 0,
        "zMax": 20    },	{		"id": "sat",		"nom": "Satellite Esri",		"url": "http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",		"attrib": "&copy;Map tiles by Esri — Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",		"zMin": 0,		"zMax": 18	},	{        "id": "natgeo",        "nom": "Esri National Geog.",        "url": "http://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",        "attrib": "tiles by &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC",        "zMin": 4,        "zMax": 16    },	{        "id": "toner",        "nom": "Stamen Toner",        "url": "http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png",        "attrib": "tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, licence <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. contributors data <a href='http://openstreetmap.org' target='_blank'>OSM</a>, licence <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>.",        "zMin": 4,        "zMax": 16    },    {        "id": "water",        "nom": "Stamen watercolor",        "url": "http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png",        "attrib": "tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, licence <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. contributors data <a href='http://openstreetmap.org' target='_blank'>OSM</a>, licence <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>.",        "zMin": 1,        "zMax": 14    },	{        "id": "thunder",        "nom": "Thunderforest",        "url": "http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png",        "attrib": "tiles by <a href='http://thunderforest.com/' target='_blank'>Thunderforest</a>. contributors data &copy;<a href='http://openstreetmap.org' target='_blank'>OSM</a>, licence <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>.",        "zMin": 0,        "zMax": 20    },	{		"id": "dark",		"nom": "Dark Matter",		"url": "http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",		"attrib": "&copy;Map tiles by <a href='https://cartodb.com/basemaps/' target='_blank'>CartoDB</a>, under <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC BY 3.0</a>. Data by <a href='http://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a>, under ODbL.",		"zMin": 0,		"zMax": 18	},	{		"id": "positron",		"nom": "Positron",		"url": "http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",		"attrib": "&copy;Map tiles by <a href='https://cartodb.com/basemaps/' target='_blank'>CartoDB</a>, under <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC BY 3.0</a>. Data by <a href='http://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a>, under ODbL.",		"zMin": 0,		"zMax": 18	}];
        // create the map
        var map = L.map('map').setView([49.5, 0.5], 10);
        // create tile layer list for the map    
        var Couches=new Array();     // couches de tiles leaflet
        var tiles={};                // désignation des tiles pour le control    
        for(i in fonds) {
            var couche=new L.TileLayer(fonds[i].url, {
                attribution: fonds[i].attrib,
                minZoom : fonds[i].zMin,
                maxZoom : fonds[i].zMax,
                unloadInvisibleTiles:true
                });
            Couches[fonds[i].id]=couche;
            tiles[fonds[i].nom]=couche;
            }
        // Install default tile layer in map (first of the list)
        var defaultTile = fonds[0].id;
        Couches[defaultTile].addTo(map);
        // Install tile selector
        var tileSelect = L.control.layers(tiles);
        tileSelect.addTo(map);        
        

        var LeafIcon = L.Icon.extend({
            options: {
                shadowUrl: 
                    'http://leafletjs.com/docs/images/leaf-shadow.png',
                iconSize:     [38, 95],
                shadowSize:   [50, 64],
                iconAnchor:   [22, 94],
                shadowAnchor: [4, 62],
                popupAnchor:  [-3, -76]
            }
        });

        var greenIcon = new LeafIcon({
            iconUrl: 'http://leafletjs.com/docs/images/leaf-green.png'
            });

        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
            position: 'topright',
            draw: {
                polygon: {
                    shapeOptions: {
                        color: 'purple'
                    },
                    allowIntersection: false,
                    drawError: {
                        color: 'orange',
                        timeout: 1000
                    },
                    showArea: true,
                    metric: false,
                    repeatMode: true
                },
                polyline: {
                    shapeOptions: {
                        color: 'red'
                    },
                },
                rect: {
                    shapeOptions: {
                        color: 'green'
                    },
                },
                circle: {
                    shapeOptions: {
                        color: 'steelblue'
                    },
                },
                marker: {
                    icon: greenIcon
                },
            },
            edit: {
                featureGroup: drawnItems
            }
        });
        map.addControl(drawControl);

        var twlf = "";
        map.on('draw:created', function (e) {
            if (twlf !== "") {
                twlf += "|";
                twlf = twlf.replace(/\s\|/g,"|");
            }
            var type = e.layerType,
                layer = e.layer,
                Coord = layer._latlngs;
                for(var c in Coord) {
                    var pair = Math.round(Coord[c].lat * 100000)/100000 + "," + Math.round(Coord[c].lng * 100000)/100000;
                    twlf += pair + " ";
                }
                document.getElementById("coord").value = twlf;
                layer.bindPopup(twlf);
            
            drawnItems.addLayer(layer);
        });

    </script>
</body>
</html>